AdsPlugin=function(){function d(e){window.performance&&performance.mark&&performance.mark(e)}function t(e){d("ad-manager-loaded"),c.dispatchEvent({type:pe,id:"adManagerLoaded"});var t=new google.ima.AdsRenderingSettings;t.disableUi=!0,t.uiElements=[],t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.useStyledLinearAds=!0,(F=e.getAdsManager(i,t)).addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,Ve),F.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,je),F.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,We),F.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,Ge),F.addEventListener(google.ima.AdEvent.Type.LOADED,Re),F.addEventListener(google.ima.AdEvent.Type.COMPLETE,Fe),F.addEventListener(google.ima.AdEvent.Type.STARTED,Ue),F.addEventListener(google.ima.AdEvent.Type.CLICK,qe),F.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,xe),F.addEventListener(google.ima.AdEvent.Type.IMPRESSION,He),F.addEventListener(google.ima.AdEvent.Type.LOG,Be),F.addEventListener(google.ima.AdEvent.Type.PAUSED,De),F.addEventListener(google.ima.AdEvent.Type.RESUMED,Oe),ge&&_e()}function l(e,t,n){var a=document.createElement(e);return a.id=t,n.appendChild(a),a}function r(e,t,n,a,i,o,s){var d=document.createElement("button");d.id=e,d.className=t,d.title=n;var l=document.createElement("span");l.className="ads_hiddenElement",l.innerHTML=n,l.setAttribute("aria-hidden","true"),d.appendChild(l);var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width",a),r.setAttribute("height",i),r.setAttribute("viewBox",o);var u=document.createElementNS("http://www.w3.org/2000/svg","use");return u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s),r.appendChild(u),d.appendChild(r),d}function u(){Tt(),d("ad-sdk-loaded"),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(K),i=c.requestVideoElement(!0),U=window.Device&&Device.iPhoneOutOfPagePlayback?new google.ima.AdDisplayContainer(b):(google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),new google.ima.AdDisplayContainer(b,i)),(H=new google.ima.AdsLoader(U)).addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,t),H.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,We),c.listenerObject={playlistLoading:Te,playlistLoaded:Le,userPlay:Se,playing:ke,ended:Ce,resize:Ne,fullscreenEnter:Ae,fullscreenExit:he,error:be,"bbc.smp.plugins.ads.event.updateAdTag":Ie,"bbc.smp.plugins.preview.complete":fe,pluginLoaded:ye};var e=c.playlist;e&&Le({playlist:e}),c.addContextMenuItem("AdsPluginHTML","AdsPluginHTML.5.0.1")}var c,g,p,m,E,n,a,i,o,s,v,y,f,A,h,T,b,L,S,k,_,C,N,P,I,w,M,D,O,B,R,x,U,H,F,e=/windows phone/i.test(navigator.userAgent),V=/iPhone/i.test(navigator.userAgent)&&!e,j=/iPod/i.test(navigator.userAgent)&&!e,G=!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)),W=!1,z=!1,q=[],K="en",Y=Number.POSITIVE_INFINITY,Q=function(){},Z=!1,$=!1,X=!1,J=!1,ee=!1,te=!1,ne=!1,ae=!1,ie=!1,oe=!0,se=!1,de=!1,le=!1,re=!1,ue=!1,ce=!1,ge=!1,pe="adsPlugin",me="adError",Ee="adDuration",ve={en:"ADVERTISEMENT",pl:"REKLAMA",da:"REKLAME",nl:"ADVERTENTIE",fi:"MAINOS",fr:"RÉCLAME",de:"ANKÜNDIGUNG",id:"ADPERTENSI",it:"INSERZIONE",ja:"広告",nn:"ANNONSE",pt:"PROPAGANDA",es:"RECLAMO",sw:"TANGAZO",sv:"REKLAM"},ye=function(e){-1===e.url.indexOf("dfpAds")&&(q=c.datastore.get("plugins").slice()),bt()},fe=function(e){(le=!0)!==o.hasAds&&!0!==W||(Z=!0,we())},Ae=function(e){ie=!0,Ke(C,"ads_exitFullScreenButton","Exit Full Screen","22","22","0 0 32 32","fullscreen-return"),a=setTimeout(Pe,510)},he=function(e){ie=!1,Ke(C,"ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),a=setTimeout(Pe,510)},Te=function(e){ze(!0),o=null,se=ue=re=le=ae=ne=te=ee=J=X=$=Z=!1,Y=Number.POSITIVE_INFINITY,ce=!1,clearInterval(v),clearInterval(y),clearInterval(n)},be=function(e){"critical"==e.severity&&Te()},Le=function(e){o||!0!==(o=e.playlist).hasAds&&!0!==W||(Z=!0,we())},Se=function(e){!0===Z&&!1===J&&(d("ad-container-init"),U.initialize(),Me())},ke=function(e){ge=!0,Z&&(J?!X&&F&&_e():(U.initialize(),Me()))},_e=function(){X=!0;try{F.init(b.clientWidth,b.clientHeight,google.ima.ViewMode.NORMAL),F.start()}catch(e){ze()}},Ce=function(e){(ae=!0)===Z&&!1===ne?(oe=!1,$e(),Xe(T),H.contentComplete()):(V||j)&&i.webkitExitFullScreen()},Ne=function(e){Pe()},Pe=function(){F&&F.resize(b.clientWidth,b.clientHeight,ie?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},Ie=function(e){g=e.data.adTag},we=function(){de&&!le||(c.pauseAt([0]),$||($=!0,Q()))},Me=function(){d("ad-request"),oe=!1,h.style.display="block",$e(),Xe(T),c.datastore.set({name:"adsPlaying",data:!0});var e=new google.ima.AdsRequest;e.adTagUrl=g,e.linearAdSlotWidth=b.clientWidth,e.linearAdSlotHeight=b.clientHeight,e.nonLinearAdSlotWidth=b.clientWidth,e.nonLinearAdSlotHeight=b.clientHeight,H.requestAds(e),c.dispatchEvent({type:pe,id:"adRequest"}),J=!0},De=function(e){Ke(k,"ads_playButton","Play","31","31","0 0 44 44","play"),clearInterval(v),clearInterval(y),ee=!0},Oe=function(e){!0===ee&&(Ke(k,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),v=setInterval(it,250),f.isSkippable&&0<Y&&ce&&(y=setInterval(at,250)),ee=!1)},Be=function(e){var t,n=e.getAdData();n&&n.adError&&("1009"===(t=n.adError).getErrorCode()&&d("ad-empty"),c.dispatchEvent({type:pe,id:me,code:t.getErrorCode(),msg:t.getMessage()}))},Re=function(e){d("ad-loaded");var t=e.getAd();s=t.getDuration(),c.dispatchEvent({type:pe,id:Ee,duration:s});e.getAdData()},xe=function(e){0<e.getAd().getDuration()&&(s=e.getAd().getDuration(),c.dispatchEvent({type:pe,id:Ee,duration:s}))},Ue=function(e){d("ad-started"),!0===(f=e.getAd()).isUiDisabled()?(ce=!0,Xe(x),R.style.bottom="",R.style.height="100%",G&&Xe(O)):(ce=!1,R.style.bottom="0",R.style.height="47px",G&&(Je(O),Xe(x))),ue=!1,c.dispatchEvent({type:pe,id:"adStarted"}),Je(T),tt(),Xe(N),-1==k.className.indexOf("ads_pauseButton")&&Ke(k,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),it(),v=setInterval(it,250),f.isSkippable()&&ce?(Ye(),y=setInterval(at,250)):Qe()},He=function(e){c.dispatchEvent({type:pe,id:"adImpression"})},Fe=function(e){d("ad-complete"),c.datastore.set({name:"adsPlaying",data:!1}),c.dispatchEvent({type:pe,id:"adEnded"}),ze()},Ve=function(e){ue||ze()},je=function(){!1===c.paused&&c.pause()},Ge=function(e){d("ad-all-complete"),ue||(oe||ze(),F&&(d("ad-manager-destroy"),F.destroy()),ne=!0,c.datastore.set({name:"adsPlaying",data:!1}),c.dispatchEvent({type:"bbc.smp.plugins.ads.event.AdsPluginExternalEvent.ALL_ADS_COMPLETED"}))},We=function(e){d("ad-error");var t=e.getError(),n=t.getErrorCode(),a=t.getInnerError(),i=0;a&&a.getErrorCode&&(i=a.getErrorCode()),c.dispatchEvent({type:pe,id:me,code:t.getErrorCode(),msg:t.getMessage()}),n===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED||i===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED?(ue=!0,ze(),c.stop(),J=!(Z=!0),we()):(ze(),Ge())},ze=function(e){oe||(Je(T),vt(),et(),Ze(),Je(N),clearInterval(v),clearInterval(y),c.pauseAt([]),e?F&&(d("ad-manager-destroy2"),F.destroy()):ae||c.play(!0),oe=!0)},qe=function(){ee||At()},Ke=function(e,t,n,a,i,o,s){e.className=t,e.title=n;var d=e.getElementsByClassName("ads_hiddenElement")[0];d&&(d.innerHTML=n);var l=e.getElementsByTagName("svg")[0];l.setAttribute("width",a),l.setAttribute("height",i),l.setAttribute("viewBox",o);var r=e.getElementsByTagName("use")[0];r&&r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s)},Ye=function(){w.style.display="block",M.style.display="block",I.style.display="none"},Qe=function(){w.style.display="none",M.style.display="none",I.style.display="none"},Ze=function(){A&&(A.style.display="none",h.style.display="none"),c.updateUiConfig({controls:{enabled:!0},cta:{enabled:!0}})},$e=function(){c.updateUiConfig({controls:{enabled:!1},cta:{enabled:!1}}),A&&(A.style.display="block",Pe())},Xe=function(e){e&&(e.style.display="block")},Je=function(e){e&&(e.style.display="none")},et=function(){R&&(R.style.display="none",B.style.display="none")},tt=function(){R&&(R.style.display="block",B.style.display="block")},nt=function(){(T=document.createElement("div")).id="ads_spinner",T.style.width="62px",T.style.height="62px",T.style.marginLeft="-31px",T.style.marginTop="-31px",T.style.top="50%",T.style.left="50%",T.style.display="none";var e=document.createElement("canvas"),t=new Sonic(e);t.width=50,t.height=50,t.colour=p,t.thickness=10,t.draw(),T.appendChild(e),h.appendChild(T)},at=function(){var e=f.getDuration()-F.getRemainingTime();0<(Y=Math.ceil(f.getSkipTimeOffset()-e))?D.innerText="Skip ad in "+Y:(I.style.display="block",M.style.display="none",clearInterval(y))},it=function(){var e=F.getRemainingTime();re||s<e&&(s=e,re=!0);var t,n=(s-e)/s;P.innerHTML=ot(e),L.clientWidth<50||isNaN(n)||(t=100*n,S.style.width=t+"%")},ot=function(e){(e=Math.round(e))<0&&(e=0);var t=e/60,n=Math.floor(t%60),a=Math.floor(e%60);return a<10&&(a="0"+a),[n,a].join(":")},st=function(e,t,n,a){for(var i="object"==typeof t?t:t.split(/\s+/g),o=0;o<i.length;o++)e.addEventListener(i[o],n,a)},dt=function(e){this.style.backgroundColor=p,this.style.fill=m},lt=function(e){this.style.backgroundColor="",this.style.fill=""},rt=function(e){this.style.border="1px solid rgba(255,255,255,1)",this.style.borderRight="0"},ut=function(e){this.style.border="1px solid rgba(255,255,255,0.5)",this.style.borderRight="0"},ct=function(e){e.stopPropagation(),Y<=0&&F.skip()},gt=function(e){se||(se=!0,n=setTimeout(function(){se=!1},500),G?("fadedOut"===R.className?Et:vt)():(ee||At(),F.clicked()))},pt=function(e){G||Et()},mt=function(e){G||vt()},Et=function(){R.className="fadedIn",k.style.pointerEvents="auto",C.style.pointerEvents="auto",I.style.pointerEvents="auto",_.style.pointerEvents="auto"},vt=function(){R.className="fadedOut",k.style.pointerEvents="none",C.style.pointerEvents="none",I.style.pointerEvents="none",_.style.pointerEvents="none"},yt=function(e){se||(se=!0,n=setTimeout(function(){se=!1},500),F.clicked())},ft=function(){se||(se=!0,n=setTimeout(function(){se=!1},500),te?(Ke(_,"ads_muteButton","Mute","44","44","0 0 44 44","audio"),F.setVolume(1)):(Ke(_,"ads_unmuteButton","UnMute","44","44","0 0 44 44","mute"),F.setVolume(0)),te=!te)},At=function(e){se||(se=!0,n=setTimeout(function(){se=!1},500),ee?(Ke(k,"ads_pauseButton","Pause","31","31","0 0 44 44","pause"),F.resume(),v=setInterval(it,250),f.isSkippable&&0<Y&&ce&&(y=setInterval(at,250))):(Ke(k,"ads_playButton","Play","31","31","0 0 44 44","play"),F.pause(),clearInterval(v),clearInterval(y)),ee=!ee)},ht=function(){se||(se=!0,n=setTimeout(function(){se=!1},500),c.toggleFullscreen())},Tt=function(){clearTimeout(E),c.updateUiConfig({cta:{enabled:!0}})},bt=function(){for(var e=0;e<q.length;e++)"PreviewPluginHTML"===q[e].id&&(de=!0)};return{pluginInitialisation:function(e){var t,n,a;d("ad-plugin-init"),c=e.playerInterface,n={id:"dfpAds",version:"5.0.1"},a=c.datastore.get("plugins"),q=a?((t=a.slice()).push(n),t):[n],c.datastore.set({name:"plugins",data:q.slice()}),bt(),c.listenerObject={pluginLoaded:ye};var i,o,s=(s=c.datastore.get("AdsPluginParameters"))||{};c.updateUiConfig({cta:{enabled:!1}}),e.loadCSS(s.cssPath?s.cssPath:"../css/dfpAds.css"),W=!!s.pretendPlaylistHasAds,g=s.adTag,z=!!s.debug,p=c.settings.ui.colour,m=c.settings.ui.foreColour,Q="function"==typeof s.setupCompanionAds?s.setupCompanionAds:function(){},function(){d("ad-create-ux"),A=l("div","ads_adsUX",c.container),st(A,"mouseenter focus",pt),st(A,"mouseleave blur",mt),b=l("div","ads_adContainer",A),(h=l("div","ads_customUI",A)).style.display="none",nt(),(R=l("div","ads_controlsContainer",h)).className="fadedOut",B=l("div","ads_bottomFade",R),x=l("div","ads_clickDiv",h),st(x,"touchend click mouseup",gt),Je(x),L=l("div","ads_seekBar",R),(S=l("div","ads_progressBar",L)).style.backgroundColor=p;var e=l("div","ads_buttonBar",R);k=r("ads_playPauseButton","ads_pauseButton","Pause","31","31","0 0 44 44","pause"),st(k,"touchend click mouseup",At),st(k,"mouseenter focus",dt),st(k,"mouseleave blur",lt),e.appendChild(k),_=r("ads_volumeButton","ads_audioButton","Mute","44","44","0 0 44 44","audio"),st(_,"touchend click mouseup",ft),st(_,"mouseenter focus",dt),st(_,"mouseleave blur",lt),e.appendChild(_),C=r("ads_fullScreenButton","ads_enterFullScreenButton","Enter Full Screen","44","44","0 0 44 44","fullscreen-enter"),st(C,"touchend click mouseup",ht),st(C,"mouseenter focus",dt),st(C,"mouseleave blur",lt),e.appendChild(C),w=l("div","ads_skipContainer",h),I=l("button","ads_skipButton",w),l("div","ads_skipButtonText",I).innerHTML+="Skip Ad";l("div","ads_skipButtonIcon",I);st(I,"touchend click mouseup",ct),st(I,"mouseenter focus",rt),st(I,"mouseleave blur",ut),M=l("div","",w),(D=l("div","ads_skipText",M)).innerHTML+="Skip ad in ",G&&(O=l("div","ads_learnmore",h),st(O,"touchend click mouseup",yt),O.innerHTML+="Learn More",Je(O)),N=l("div","ads_countdownText",h),Je(N);var t=l("span","",N),n={"en-GB":"en","en-gb":"en","cy-GB":"cy","cy-gb":"cy","gd-GB":"gd","gd-gb":"gd","ga-GB":"ga","ga-gb":"ga","ru-uk":"ru",zh:"zh-hans"};n[K=c.settings.ui.locale.lang]&&(K=n[K]);var a=ve[K]?ve[K]:ve.en;t.innerHTML=a+" ",(P=l("span","",N)).innerHTML="0:00",d("ad-create-ux-complete")}(),E=setTimeout(function(){Tt()},5e3),i=u,d("ad-sdk-load"),window.google&&window.google.ima?i():((o=document.createElement("script")).async=!0,o.type="text/javascript",o.onload=function(){i()},o.src=document.location.protocol+(!0===z?"//imasdk.googleapis.com/js/sdkloader/ima3_debug.js":"//imasdk.googleapis.com/js/sdkloader/ima3.js"),document.getElementsByTagName("head")[0].appendChild(o))},reset:function(){clearTimeout(n),clearTimeout(a),clearTimeout(E),Te()}}}();var runPlugin=function(e,t){return e.register({name:"dfpAds.js"}),AdsPlugin};